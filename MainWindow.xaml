<Window x:Class="GestaoAulas.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:utils="clr-namespace:GestaoAulas.Utils"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Background="{DynamicResource MaterialDesignPaper}"
        mc:Ignorable="d"
        Title="Gestor de Serviços" 
        Height="850" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <utils:StatusToBrushConverter x:Key="StatusToBrush"/>
        <!-- Converters -->
    </Window.Resources>

    <Grid Background="#0a0b10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Cards Stats -->
            <RowDefinition Height="Auto"/> <!-- Filtros -->
            <RowDefinition Height="Auto"/> <!-- SubHeader Adicionar -->
            <RowDefinition Height="*"/>    <!-- Grid -->
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Grid Grid.Row="0" Margin="24,24,24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            

            <TextBlock Text="Gestão de Serviços &amp; Aulas" 
                       FontSize="22" 
                       FontWeight="Bold" 
                       Foreground="White"
                       VerticalAlignment="Center"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Button Content="Configuracoes" 
                        Command="{Binding AbrirConfiguracoesCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}" 
                        Foreground="White"
                        BorderBrush="#cccccc"
                        BorderThickness="1"
                        Height="40"
                        Padding="16,0"
                        Margin="0,0,12,0"/>
                <Button Content="Exportar Dados" 
                        Command="{Binding ExportarDadosCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Foreground="White"
                        BorderBrush="#cccccc"
                        BorderThickness="1"
                        Height="40"
                        Padding="16,0"/>
            </StackPanel>
        </Grid>

        <!-- DASHBOARD -->
        <Grid Grid.Row="1" Margin="24,8,24,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Card 1: Horas Totais -->
            <Border Grid.Column="0" Margin="0,0,12,0" Padding="16,16,16,20" Background="#162c46">
                <Grid>
                    <StackPanel>
                        <TextBlock Text="Total de Horas (Mês)" Foreground="#94a3b8" FontSize="13"/>
                        <TextBlock Text="{Binding TotalHorasFormatado}" FontWeight="Bold" FontSize="26" Margin="0,8,0,0" Foreground="White"/>
                    </StackPanel>
                    <Border VerticalAlignment="Bottom" Height="2" Background="#3b82f6" Margin="-16,0,-16,-20"/>
                </Grid>
            </Border>

            <!-- Card 2: Valor Pendente -->
            <Border Grid.Column="1" Margin="12,0,12,0" Padding="16,16,16,20" Background="#431407">
                <Grid>
                    <StackPanel>
                        <TextBlock Text="Valor Pendente" Foreground="#94a3b8" FontSize="13"/>
                        <TextBlock Text="{Binding TotalPendenteFormatado}" FontWeight="Bold" FontSize="26" Margin="0,8,0,0" Foreground="#f97316"/>
                    </StackPanel>
                    <Border VerticalAlignment="Bottom" Height="2" Background="#f97316" Margin="-16,0,-16,-20"/>
                </Grid>
            </Border>

            <!-- Card 3: Total Recebido -->
            <Border Grid.Column="2" Margin="12,0,12,0" Padding="16,16,16,20" Background="#064e3b">
                <Grid>
                    <StackPanel>
                        <TextBlock Text="Total Recebido" Foreground="#94a3b8" FontSize="13"/>
                        <TextBlock Text="{Binding TotalRecebidoFormatado}" FontWeight="Bold" FontSize="26" Margin="0,8,0,0" Foreground="#10b981"/>
                    </StackPanel>
                    <Border VerticalAlignment="Bottom" Height="2" Background="#10b981" Margin="-16,0,-16,-20"/>
                </Grid>
            </Border>

            <!-- Card 4: Qtd Aulas -->
            <Border Grid.Column="3" Margin="12,0,0,0" Padding="16,16,16,20" Background="#162c46">
                <Grid>
                    <StackPanel>
                        <TextBlock Text="Qtd. Serviços" Foreground="#94a3b8" FontSize="13"/>
                        <TextBlock Text="{Binding TotalAulas}" FontWeight="Bold" FontSize="26" Margin="0,8,0,0" Foreground="#3b82f6"/>
                    </StackPanel>
                    <Border VerticalAlignment="Bottom" Height="2" Background="#3b82f6" Margin="-16,0,-16,-20"/>
                </Grid>
            </Border>
        </Grid>

        <!-- FILTROS (Período) -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="24,16,24,16">
            <TextBlock Text="Período:" Foreground="#94a3b8" VerticalAlignment="Center" Margin="0,0,16,0" FontSize="14"/>
            <ComboBox ItemsSource="{Binding Meses}"
                      DisplayMemberPath="Value"
                      SelectedValuePath="Key"
                      SelectedValue="{Binding MesSelecionado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                      materialDesign:HintAssist.Hint="Mês"
                      Foreground="White"
                      Width="150"
                      Height="45"
                      VerticalContentAlignment="Center"
                      Margin="0,0,12,0">
                <ComboBox.Resources>
                    <SolidColorBrush x:Key="MaterialDesignPaper" Color="#16213e"/>
                </ComboBox.Resources>
            </ComboBox>
            <ComboBox ItemsSource="{Binding Anos}"
                      SelectedValue="{Binding AnoSelecionado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                      materialDesign:HintAssist.Hint="Ano"
                      Foreground="White"
                      Width="110"
                      Height="45"
                      VerticalContentAlignment="Center">
                <ComboBox.Resources>
                    <SolidColorBrush x:Key="MaterialDesignPaper" Color="#16213e"/>
                </ComboBox.Resources>
            </ComboBox>
        </StackPanel>

        <!-- ADD NEW AULA SECTION -->
        <Grid Grid.Row="3" Margin="24,16,24,16">
            <StackPanel>
                <TextBlock Text="ADICIONAR NOVO SERVIÇO/AULA" FontWeight="Bold" Foreground="White" Opacity="0.9" Margin="0,0,0,12" FontSize="14"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,16,0">
                        <TextBlock Text="Data (DD/MM/AAAA):" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                        <TextBox x:Name="txtNovaData" Width="150"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Foreground="White"
                                 BorderBrush="#334155"
                                 MaxLength="10"
                                 PreviewTextInput="Data_PreviewTextInput"
                                 PreviewKeyDown="Data_PreviewKeyDown"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,16,0">
                        <TextBlock Text="Categoria:" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                         <ComboBox Width="120"
                                  ItemsSource="{Binding Categorias}"
                                  SelectedItem="{Binding NovaCategoriaSelecionada}"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  Foreground="White"
                                  BorderBrush="#334155"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="0,0,16,0">
                        <TextBlock Text="Descrição/Serviço:" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                        <TextBox Text="{Binding NovoAluno, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Foreground="White"
                                 BorderBrush="#334155"
                                 materialDesign:TextFieldAssist.HasClearButton="True"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3" Margin="0,0,16,0">
                        <Grid>
                            <!-- Campo Duração (Visível apenas se Aula) -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsNovaAula}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="Duração (h):" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                                <TextBox Width="80"
                                         Text="{Binding NovaDuracao, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Foreground="White"
                                         BorderBrush="#334155"
                                         MaxLength="5"
                                         PreviewTextInput="Duracao_PreviewTextInput"
                                         PreviewKeyDown="Duracao_PreviewKeyDown"/>
                            </StackPanel>

                            <!-- Campo Valor Manual (Visível apenas se NÃO for Aula) -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsNovaAula}" Value="False">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="Valor (R$):" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                                <TextBox Width="80"
                                         Text="{Binding NovoValorStr, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         Foreground="White"
                                         BorderBrush="#334155"
                                         materialDesign:HintAssist.Hint="0,00"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>

                    <StackPanel Grid.Column="4" Margin="0,0,16,0">
                        <TextBlock Text="Status:" Foreground="#94a3b8" FontSize="12" Margin="0,0,0,6"/>
                        <ComboBox Width="120"
                                  SelectedIndex="{Binding NovoStatusIndex}"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  Foreground="White"
                                  BorderBrush="#334155">
                            <ComboBoxItem Content="Pendente"/>
                            <ComboBoxItem Content="Pago"/>
                        </ComboBox>
                    </StackPanel>

                    <Button Grid.Column="5"
                            Content="+ Adicionar"
                            Background="#22c55e"
                            BorderBrush="#22c55e"
                            Foreground="White"
                            Height="38"
                            VerticalAlignment="Bottom"
                            Padding="20,0"
                            Click="Adicionar_Click"
                            ToolTip="Adicionar Aula (Enter)"/>
                </Grid>
            </StackPanel>
        </Grid>

        <!-- DATA GRID -->
        <Border Grid.Row="4" Margin="24,8,24,24" BorderBrush="#334155" BorderThickness="1">
            <DataGrid x:Name="dgAulas"
                      ItemsSource="{Binding Aulas}"
                      SelectedItem="{Binding AulaSelecionada}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserReorderColumns="False"
                      HeadersVisibility="Column"
                      SelectionUnit="FullRow"
                      IsReadOnly="True"
                      Background="#111827"
                      Foreground="White"
                      BorderThickness="0"
                      GridLinesVisibility="None"
                      RowHeight="40"
                      MouseDoubleClick="DataGrid_MouseDoubleClick">
                
                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                        <Setter Property="Background" Value="#111827"/>
                        <Setter Property="Foreground" Value="#f8fafc"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="BorderBrush" Value="#cbd5e1"/>
                        <Setter Property="Padding" Value="12,10"/>
                    </Style>
                    <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                        <Setter Property="Background" Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#1f2937"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                    <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="BorderBrush" Value="#334155"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="MinHeight" Value="40"/>
                    </Style>
                </DataGrid.Resources>

                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Editar" Command="{Binding EditarAulaCommand}">
                            <MenuItem.Icon><materialDesign:PackIcon Kind="Pencil"/></MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Excluir" Command="{Binding ExcluirAulaCommand}">
                            <MenuItem.Icon><materialDesign:PackIcon Kind="Delete"/></MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="Marcar Pago" Command="{Binding MarcarComoPagoCommand}"/>
                        <MenuItem Header="Marcar Pendente" Command="{Binding MarcarComoPendenteCommand}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="DATA" Binding="{Binding DataFormatada}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="DIA" Binding="{Binding DiaSemana}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="CATEGORIA" Binding="{Binding Categoria}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="DESCRIÇÃO / SERVIÇO" Binding="{Binding NomeAula}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="10,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="DURAÇÃO (h)" Binding="{Binding DuracaoFormatada}" Width="140">
                         <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="VALOR (R$)" Binding="{Binding ValorFormatado}" Width="140">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTemplateColumn Header="STATUS" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{Binding Status, Converter={StaticResource StatusToBrush}}" 
                                        CornerRadius="4" Padding="12,4" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Status}" Foreground="White" FontSize="11" FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</Window>
